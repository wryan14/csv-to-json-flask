{% extends 'base.html' %}

{% block title %}CSV to JSON Converter{% endblock %}

{% block content %}
	<h1 class="mb-3">CSV to JSON Converter</h1>
	<form id="csvForm" action="{{ url_for('views.upload_file') }}" method="POST" enctype="multipart/form-data">
		<div class="form-group">
			<label for="csvFile">Select a CSV file:</label>
			<input type="file" class="form-control-file" id="csvFile" name="file">
		</div>
		<div class="form-check">
			<input class="form-check-input" type="radio" name="json_option" id="replaceRadio" value="replace" checked>
			<label class="form-check-label" for="replaceRadio">
				Replace existing data
			</label>
		</div>
		<div class="form-check">
			<input class="form-check-input" type="radio" name="json_option" id="appendRadio" value="append">
			<label class="form-check-label" for="appendRadio">
				Append to existing data
			</label>
		</div>
		<button type="submit" class="btn btn-primary">Convert to JSON</button>
	</form>
	<div id="success-message" style="display: none;">Data saved successfully!</div>
	<script>
		// Handle form submission with AJAX
		document.getElementById("csvForm").addEventListener("submit", function(event) {
			event.preventDefault();
			let form_data = new FormData(document.getElementById("csvForm"));
			let xhr = new XMLHttpRequest();
			xhr.open("POST", "{{ url_for('views.upload_file') }}", true);
			xhr.onload = function (e) {
				if (xhr.readyState === 4) {
					if (xhr.status === 200) {
						document.getElementById("csvForm").reset();
						document.getElementById("success-message").style.display = "block";
					} else {
						console.error(xhr.statusText);
					}
				}
			};
			xhr.send(form_data);
		});
	</script>
{% endblock %}
